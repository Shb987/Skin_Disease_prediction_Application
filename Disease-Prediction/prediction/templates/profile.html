{% extends 'base.html' %}

{% block title %}User Profile - SkinCheck AI{% endblock %}=

{% block content %}
<div class="mb-8">
  <h1 class="text-2xl font-bold text-gray-800">User Profile</h1>
  <p class="text-gray-600">Manage your account settings and preferences</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
  <!-- Left side (personal info + security) -->
  <div class="lg:col-span-2">
    <!-- Personal Information -->
    <div class="bg-white p-6 rounded-xl shadow border border-gray-100 mb-6">
      <h2 class="text-lg font-semibold text-gray-800 mb-6">Personal Information</h2>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
            <input type="text" name="first_name" value="{{ user.first_name }}"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
            <input type="text" name="last_name" value="{{ user.last_name }}"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
            <input type="email" name="email" value="{{ user.email }}"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
            <input type="tel" name="phone" value="{{ profile.phone|default:'' }}"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">Institution</label>
            <input type="text" name="institution" value="{{ profile.institution|default:'' }}"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
          </div>
        </div>
        <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          Save Changes
        </button>
      </form>
    </div>

    <!-- Security -->
    <div class="bg-white p-6 rounded-xl shadow border border-gray-100">
      <h2 class="text-lg font-semibold text-gray-800 mb-6">Security</h2>
      <form method="post" action="{% url 'change_password' %}">
        {% csrf_token %}
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Current Password</label>
            <input type="password" name="old_password"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
            <input type="password" name="new_password1"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password</label>
            <input type="password" name="new_password2"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
          </div>
        </div>
        <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          Update Password
        </button>
      </form>
    </div>
  </div>

  <!-- Right side (profile photo + preferences) -->
  <div>
    <!-- Profile Photo -->
    <div class="bg-white p-6 rounded-xl shadow border border-gray-100 mb-6">
      <h2 class="text-lg font-semibold text-gray-800 mb-6">Profile Photo</h2>
      <div class="flex flex-col items-center">
        {% if profile.photo %}
        <img src="{{ profile.photo.url }}" class="w-32 h-32 rounded-full object-cover mb-4" alt="Profile photo" />
        {% else %}
        <div class="w-32 h-32 bg-blue-100 rounded-full flex items-center justify-center mb-4">
          <svg class="h-16 w-16 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
        </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" action="{% url 'upload_profile_photo' %}">
          {% csrf_token %}
          <label
            class="px-4 py-2 bg-blue-600 text-white rounded-lg inline-block cursor-pointer hover:bg-blue-700 transition mb-2">
            Upload Photo
            <input type="file" name="photo" class="hidden" onchange="this.form.submit()" />
          </label>
        </form>

        {% if profile.photo %}
        <form method="post" action="{% url 'remove_profile_photo' %}">
          {% csrf_token %}
          <button type="submit" class="text-red-500 text-sm hover:text-red-700">Remove Photo</button>
        </form>
        {% endif %}
      </div>
    </div>

    <!-- Preferences -->
    <div class="bg-white p-6 rounded-xl shadow border border-gray-100">
      <h2 class="text-lg font-semibold text-gray-800 mb-6">Account Preferences</h2>
      <form method="post" action="{% url 'update_preferences' %}">
        {% csrf_token %}
        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="font-medium">Email Notifications</h3>
              <p class="text-sm text-gray-500">Receive updates about your scans</p>
            </div>
            <input type="checkbox" name="email_notifications" {% if profile.email_notifications %}checked{% endif %} />
          </div>
          <div class="flex items-center justify-between">
            <div>
              <h3 class="font-medium">Research Participation</h3>
              <p class="text-sm text-gray-500">Help improve our AI models</p>
            </div>
            <input type="checkbox" name="research_participation" {% if profile.research_participation %}checked{% endif
              %} />
          </div>
        </div>
        <button type="submit" class="mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          Save Preferences
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}